/*
 * oled_ssd1306.c
 *
 *  Created on: 26-Dec-2025
 *      Author: sreer
 */
void OLED_Cmd(uint8_t cmd) {
    I2C1->CR1 |= I2C_CR1_START;
    while (!(I2C1->SR1 & I2C_SR1_SB));
    I2C1->DR = 0x3C << 1;
    while (!(I2C1->SR1 & I2C_SR1_ADDR));
    (void)I2C1->SR2;

    I2C1->DR = 0x00; // Co=0, D/C#=0 (Command)
    while (!(I2C1->SR1 & I2C_SR1_TXE));
    I2C1->DR = cmd;
    while (!(I2C1->SR1 & I2C_SR1_BTF));
    I2C1->CR1 |= I2C_CR1_STOP;
}

void OLED_Init(void) {
    uint8_t init_cmds[] = {0xAE, 0xD5, 0x80, 0xA8, 0x3F, 0xD3, 0x00, 0x40, 0x8D, 0x14, 0xAF};
    for(int i=0; i<sizeof(init_cmds); i++) OLED_Cmd(init_cmds[i]);
}

