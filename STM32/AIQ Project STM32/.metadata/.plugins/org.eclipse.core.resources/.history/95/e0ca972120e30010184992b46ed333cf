/*
 * stm32f446xx.h
 *
 *  Created on: 26-Dec-2025
 *      Author: sreer
 */

#ifndef STM32F446XX_H_
#define STM32F446XX_H_

#include <stdint.h> // Required for uint32_t, uint8_t

/* RCC Register Definitions */
#define RCC_BASEADDR 0x40023800U
typedef struct {
  volatile uint32_t CR;
  volatile uint32_t PLLCFGR;
  volatile uint32_t CFGR;
  volatile uint32_t CIR;
  volatile uint32_t AHB1RSTR;
  volatile uint32_t AHB2RSTR;
  volatile uint32_t AHB3RSTR;
  uint32_t RESERVED0;
  volatile uint32_t APB1RSTR;
  volatile uint32_t APB2RSTR;
  uint32_t RESERVED1[2];
  volatile uint32_t AHB1ENR;
  volatile uint32_t AHB2ENR;
  volatile uint32_t AHB3ENR;
  uint32_t RESERVED2;
  volatile uint32_t APB1ENR;
  volatile uint32_t APB2ENR;
} RCC_RegDef_t;
#define RCC ((RCC_RegDef_t *)RCC_BASEADDR)

#define RCC_AHB1ENR_GPIOAEN (1 << 0)
#define RCC_AHB1ENR_GPIOBEN (1 << 1)
#define RCC_APB1ENR_I2C1EN (1 << 21)
#define RCC_APB2ENR_SPI1EN (1 << 12)

/* GPIO Register Definitions */
typedef struct {
  volatile uint32_t MODER;
  volatile uint32_t OTYPER;
  volatile uint32_t OSPEEDR;
  volatile uint32_t PUPDR;
  volatile uint32_t IDR;
  volatile uint32_t ODR;
  volatile uint32_t BSRR;
  volatile uint32_t LCKR;
  volatile uint32_t AFR[2];
} GPIO_RegDef_t;

#define GPIOA ((GPIO_RegDef_t *)0x40020000U)
#define GPIOB ((GPIO_RegDef_t *)0x40020400U)

/* GPIO Bit Positions (Clean - No Duplicates) */
#define GPIO_MODER_MODER4_Pos (8U)
#define GPIO_MODER_MODER5_Pos (10U)
#define GPIO_MODER_MODER6_Pos (12U)
#define GPIO_MODER_MODER7_Pos (14U)
#define GPIO_MODER_MODER8_Pos (16U)
#define GPIO_MODER_MODER9_Pos (18U)

#define GPIO_OTYPER_OT8_Pos (8U)
#define GPIO_OTYPER_OT9_Pos (9U)

#define GPIO_BSRR_BS4 (1 << 4)

#define GPIO_AFRL_AFSEL5_Pos (20U)
#define GPIO_AFRL_AFSEL6_Pos (24U)
#define GPIO_AFRL_AFSEL7_Pos (28U)

#define GPIO_AFRH_AFSEL8_Pos (0U)
#define GPIO_AFRH_AFSEL9_Pos (4U) // Fixed: Added missing AFSEL9

/* I2C Register Definitions */
typedef struct {
  volatile uint32_t CR1;
  volatile uint32_t CR2;
  volatile uint32_t OAR1;
  volatile uint32_t OAR2;
  volatile uint32_t DR;
  volatile uint32_t SR1;
  volatile uint32_t SR2;
  volatile uint32_t CCR;
  volatile uint32_t TRISE;
} I2C_RegDef_t;
#define I2C1 ((I2C_RegDef_t *)0x40005400U)

#define I2C_CR1_START (1 << 8)
#define I2C_CR1_STOP (1 << 9)
#define I2C_CR1_ACK (1 << 10)
#define I2C_CR1_PE (1 << 0)
#define I2C_SR1_SB (1 << 0)
#define I2C_SR1_ADDR (1 << 1)
#define I2C_SR1_BTF (1 << 2)
#define I2C_SR1_RXNE (1 << 6)
#define I2C_SR1_TXE (1 << 7) // Add this line
// Add to RCC section
#define RCC_APB1ENR_USART2EN (1 << 17)

/* USART Register Definitions */
typedef struct {
  volatile uint32_t SR;
  volatile uint32_t DR;
  volatile uint32_t BRR;
  volatile uint32_t CR1;
  volatile uint32_t CR2;
  volatile uint32_t CR3;
  volatile uint32_t GTPR;
} USART_RegDef_t;

#define USART2 ((USART_RegDef_t *)0x40004400U)

/* Add to GPIO section */
#define GPIO_MODER_MODER2_Pos (4)
#define GPIO_MODER_MODER3_Pos (6)
#define GPIO_AFRL_AFSEL2_Pos (8)
#define GPIO_AFRL_AFSEL3_Pos (12)
/* SPI Register Structure */
typedef struct {
    volatile uint32_t CR1;    volatile uint32_t CR2;
    volatile uint32_t SR;     volatile uint32_t DR;
    volatile uint32_t CRCPR;  volatile uint32_t RXCRCR;
    volatile uint32_t TXCRCR; volatile uint32_t I2SCFGR;
    volatile uint32_t I2SPR;
} SPI_RegDef_t;

#define SPI1 ((SPI_RegDef_t*)0x40013000U) // SPI1 Base Address

/* SPI Status Register Bits */
#define SPI_SR_RXNE (1 << 0) // Receive buffer not empty
#define SPI_SR_TXE  (1 << 1) // Transmit buffer empty
#endif
